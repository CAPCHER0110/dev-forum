# apps/go-api/Dockerfile

# Stage 1: Build
FROM golang:1.25-alpine AS builder

ENV GO111MODULE=on \
    CGO_ENABLED=0 \
    GOOS=linux \
    GOARCH=amd64

WORKDIR /build

# å¤åˆ¶ä¾èµ–å®šä¹‰
COPY go.mod go.sum ./
RUN go mod download

# å¤åˆ¶æ‰€æœ‰æºç 
COPY . .

# ğŸ”¥ å…³é”®ä¿®æ”¹ï¼šç¼–è¯‘è·¯å¾„æŒ‡å‘ cmd/server/main.go
RUN go build -o server ./cmd/server/main.go

# Stage 2: Runtime
FROM alpine:latest

WORKDIR /app

RUN apk --no-cache add ca-certificates tzdata

COPY --from=builder /build/server ./server

EXPOSE 4000

CMD ["./server"]